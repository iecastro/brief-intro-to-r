<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Welcome</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ivan Castro   VISN 2 CIH - Syracuse" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/shinobi.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
    <script src="libs/jquery-1.12.4/jquery.min.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.7/datatables.js"></script>
    <link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Welcome
## Brief intro to R <br> üôå
### Ivan Castro <br /> VISN 2 CIH - Syracuse

---




## What we will cover today

- Just the tip of the iceberg...

- There's not enough time to cover everything

- The content presented today is largely based on the [Data science in a Box](https://datasciencebox.org/content/explore/) materials

- Given our roles, we will focus on:
  1. How to start interacting with R  
  2. How to wrangle data in R  

--

### Things we won't cover 

...but I'll gladly help you with otherwise:

- Advanced data wrangling
- Advanced visualization
- Data modelling
- Handling spatial data
--
---
class: center 

## What data projects look like


.center[
&gt;Anyone who has ever taken wild-caught data through the full process of analysis knows that statistics, in the strict sense of fitting models and doing inference, is but one small part of the process.
&gt;
&gt; Bryan &amp; Wickham ([2017](https://www.tandfonline.com/doi/full/10.1080/10618600.2017.1389743))  
]

--
.center[
![](https://github.com/hadley/r4ds/raw/master/diagrams/data-science-wrangle.png)
]

--

---

## Who Am I?

- Coordinator in Dr. Possemato's lab

- Fairly new to CIH (less than a year)

- Learned R (largely on my own) during graduate school 

- Trained in biostats

- Enjoy working with [messy data](https://brohrer.github.io/data_science_archetypes.html)


.center[
![](img/data-mechs.png)
]

---
class: right, middle

## Find me at...

&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 512 512"&gt;&lt;path d="M443.683 4.529L27.818 196.418C-18.702 217.889-3.39 288 47.933 288H224v175.993c0 51.727 70.161 66.526 91.582 20.115L507.38 68.225c18.905-40.961-23.752-82.133-63.697-63.696z"/&gt;&lt;/svg&gt; BHOC F204
&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 512 512"&gt;&lt;path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/&gt;&lt;/svg&gt; ivan.castro@va.gov    
&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 512 512"&gt;&lt;path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/&gt;&lt;/svg&gt; iecastro@syr.edu
&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 496 512"&gt;&lt;path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/&gt;&lt;/svg&gt; [iecastro](https://github.com/iecastro) 
&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"&gt;&lt;path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/&gt;&lt;/svg&gt; [iecastro](https://www.linkedin.com/in/iecastro)
---

class: title-slide

# Meet the toolkit &lt;br&gt; ‚öí

---
class: center, middle

# Reproducible data wrangling and analysis

---

## Reproducibility checklist

.question[
What does it mean for a data analysis to be "reproducible"?
]

--

Near-term goals:

- Are the tables and figures reproducible from the code and data?
- Does the code actually do what you think it does?
- In addition to what was done, is it clear **why** it was done? 
(e.g., how were parameter settings chosen?)

Long-term goals:

- Can the code be used for other data?
- Can you extend the code to do other things?

---

## From manual tasking...

&lt;img src="img/manual-datapull.png" width="1000" height="500" style="display: block; margin: auto;" /&gt;

---

## ... to reproducible code

&lt;img src="img/script-datapull.png" width="1000" height="500" style="display: block; margin: auto;" /&gt;

---

## Reproducible plots

![](img/rep-plot.PNG)

---

## Toolkit

![toolkit](img/toolkit.png)

- Scriptability `\(\rightarrow\)` R
- Literate programming (code, narrative, output in one place) `\(\rightarrow\)` R Markdown
- Version control `\(\rightarrow\)` Git / GitHub

---

class: center, middle

# R and RStudio

---

## What is R

- R is a statistical programming language

- Don't be discouraged by the word _programming_

- R is first and foremost for data analysis

&gt;_You must use a computer to do data science; you cannot do it in your head, or with pencil and paper._
&gt;
&gt;Hadley Wickham
&gt;

.center[
![](https://github.com/hadley/r4ds/raw/master/diagrams/data-science-program.png)
]

.footnote[
‚û• Source: [R for Data Science](https://r4ds.had.co.nz/)
]


---
## What is RStudio?

- RStudio is a convenient interface for R (an integreated development environment, IDE)
- At its simplest:&lt;sup&gt;‚û•&lt;/sup&gt;
    - R is like a car‚Äôs engine
    - RStudio is like a car‚Äôs dashboard

&lt;img src="img/engine-dashboard.png" style="display: block; margin: auto;" /&gt;

.footnote[
‚û• Source: [Modern Dive](https://moderndive.com/)
]

---

## Let's take a tour - R / RStudio

.center[
![](../img/demo.png)
]

Concepts introduced:

- Console
- Using R as a calculator
- Environment
- Loading and viewing a data frame
- Accessing a variable in a data frame
- R functions

---

## R essentials

A short list (for now):

- Functions are (most often) verbs, followed by what they will be applied to in parantheses:


```r
do_this(to_this)
do_that(to_this, to_that, with_those)
```

--

- Columns (variables) in data frames are accessed with `$`:


```r
dataframe$var_name
```

--

- Packages are installed with the `install.packages` function and loaded with the `library` function, once per session:


```r
install.packages("package_name")
library(package_name)
```

--

- For this project we'll need the following packages: 


```r
install.packages(c("tidyverse", "devtools", "datasauRus", "fivethirtyeight", "janitor"))
```
--
---

## tidyverse

.pull-left[
![](img/tidyverse.png)
]

.pull-right[
.center[
[tidyverse.org](https://www.tidyverse.org/)
]

- The tidyverse is an opinionated collection of R packages designed for data science. 
- All packages share an underlying philosophy and a common grammar. 
]

---

class: center, middle

# R Markdown

---


## R Markdown

- Fully reproducible reports -- each time you knit the analysis is ran from the beginning
- Simple markdown syntax for text
- Code goes in chunks, defined by three backticks, narrative goes outside of chunks

---

## Let's take a tour - R Markdown


.center[
![](../img/demo.png)
]

Concepts introduced:

- Knitting documents
- R Markdown and (some) R syntax

---

## &lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 640 512"&gt;&lt;path d="M512 64v256H128V64h384m16-64H112C85.5 0 64 21.5 64 48v288c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm100 416H389.5c-3 0-5.5 2.1-5.9 5.1C381.2 436.3 368 448 352 448h-64c-16 0-29.2-11.7-31.6-26.9-.5-2.9-3-5.1-5.9-5.1H12c-6.6 0-12 5.4-12 12v36c0 26.5 21.5 48 48 48h544c26.5 0 48-21.5 48-48v-36c0-6.6-5.4-12-12-12z"/&gt;&lt;/svg&gt;  Bechdel Test 

.question[
What is the Bechdel test?
]

--

The Bechdel test asks whether a work of fiction features at least two women who talk to each other about something other than a man, and there must be two women named characters.

--

- Go to RStudio Cloud and open the application exercise (AE-02).
- Knit the R Markdown document.

---

## Other things you can make in R markdown

&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 384 512"&gt;&lt;path d="M193.7 271.2c8.8 0 15.5 2.7 20.3 8.1 9.6 10.9 9.8 32.7-.2 44.1-4.9 5.6-11.9 8.5-21.1 8.5h-26.9v-60.7h27.9zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-153 31V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm53 165.2c0 90.3-88.8 77.6-111.1 77.6V436c0 6.6-5.4 12-12 12h-30.8c-6.6 0-12-5.4-12-12V236.2c0-6.6 5.4-12 12-12h81c44.5 0 72.9 32.8 72.9 77z"/&gt;&lt;/svg&gt; These slides
&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 384 512"&gt;&lt;path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"/&gt;&lt;/svg&gt; [HTML resume](https://iecastro.github.io/web-resume)
&lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 512 512"&gt;&lt;path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/&gt;&lt;/svg&gt; [Web link](https://iecastro.github.io/blog/2018-09-13/ndi-dist-prof.html)

--

... ok, enough self promotion üè¢

---
## R Markdown help

.pull-left[
.center[
[R Markdown cheat sheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)
]
![](img/rmd-cheatsheet.png)
]
.pull-right[
.center[
Markdown Quick Reference  
`Help -&gt; Markdown Quick Reference`
]
![](img/md-cheatsheet.png)
]

---

## Workspaces

Remember this, and expect it to bite you a few times as you're learning to work 
with R Markdown: The workspace of your R Markdown document is separate from the Console!

- Run the following in the console

```r
x &lt;- 2
x * 3
```
.question[
All looks good, eh?
]

- Then, add the following chunk in your R Markdown document

```r
x * 3
```
.question[
What happens? Why the error?
]

---

## How will we use R Markdown?

- Workshop tutorials are in R Markdown documents
- You'll always have a template R Markdown document to start with

---

class: center, middle

# Git and GitHub

---

## Version control

- GitHub as a platform for collaboration
- It's actually desiged for version control

---

## Versioning

&lt;img src="img/lego-steps.png" width="1200" style="display: block; margin: auto;" /&gt;

---

## Versioning 

with human readable messages

&lt;img src="img/lego-steps-commit-messages.png" width="1200" style="display: block; margin: auto;" /&gt;

---

## Why do we need version control?

&lt;img src="img/phd_comics_vc.gif" style="display: block; margin: auto;" /&gt;

---

# Git and GitHub tips

- Git is a version control system -- like ‚ÄúTrack Changes‚Äù features from Microsoft Word on steroids. GitHub is the home for your Git-based projects on the internet -- like DropBox but much, much better).

--
- There are millions of git commands -- ok, that's an exaggeration, but there are a lot of them -- and very few people know them all. 99% of the time you will use git to add, commit, push, and pull.

--
- __This is outside the scope of this workshop and I've found difficult to set up in a VA computer.__

--
- There is a great resource for working with git and R: [happygitwithr.com](http://happygitwithr.com/).

---
class: title-slide

# Tidy data and data wrangling &lt;br&gt; üîß

---

class: center, middle

# Tidy data

---

## Tidy data

&gt;Happy families are all alike; every unhappy family is unhappy in its own way. 
&gt;
&gt;Leo Tolstoy
&gt;

--

.pull-left[
**Characteristics of tidy data:**

- Each variable forms a column.
- Each observation forms a row.
- Each type of observational unit forms a table.
]
--
.pull-right[
**Characteristics of untidy data:**

!@#$%^&amp;*()
]

--
---
## Tidy data

&gt;Like families, tidy datasets are all alike but every messy dataset is messy in its own way.
&gt;
&gt; Hadley Wickham

--

![](https://raw.githubusercontent.com/hadley/r4ds/master/images/tidy-1.png)

.footnote[
‚û• Source: [R for Data Science](https://r4ds.had.co.nz/)
]

--

---
## Summary tables 

.question[
Is each of the following a dataset or a summary table?
]

.small[
.pull-left[

```
## # A tibble: 87 x 3
##    name               height  mass
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt;
##  1 Luke Skywalker        172    77
##  2 C-3PO                 167    75
##  3 R2-D2                  96    32
##  4 Darth Vader           202   136
##  5 Leia Organa           150    49
##  6 Owen Lars             178   120
##  7 Beru Whitesun lars    165    75
##  8 R5-D4                  97    32
##  9 Biggs Darklighter     183    84
## 10 Obi-Wan Kenobi        182    77
## # ‚Ä¶ with 77 more rows
```
]
.pull-right[

```
## # A tibble: 5 x 2
##   gender        avg_height
##   &lt;chr&gt;              &lt;dbl&gt;
## 1 &lt;NA&gt;                120 
## 2 female              165.
## 3 hermaphrodite       175 
## 4 male                179.
## 5 none                200
```
]
]

---

class: center, middle

# Pipes

---

## Where does the name come from?

The pipe operator is implemented in the package **magrittr**, it's pronounced 
"and then".

.pull-left[
![pipe](img//magritte.jpg)
]
.pull-right[
![magrittr](img//magrittr.jpg)
]

---

## Review: How does a pipe work?

- You can think about the following sequence of actions - find key, 
unlock car, start car, drive to school, park.
- Expressed as a set of nested functions in R pseudocode this would look like:

```r
park(drive(start_car(find("keys")), to = "campus"))
```
- Writing it out using pipes give it a more natural (and easier to read) 
structure:

```r
find("keys") %&gt;%
  start_car() %&gt;%
  drive(to = "campus") %&gt;%
  park()
```

---

## What about other arguments?

To send results to a function argument other than first one or to use the previous result for multiple arguments, use `.`:


```r
starwars %&gt;%
  filter(species == "Human") %&gt;%
  lm(mass ~ height, data = .)
```

```
## 
## Call:
## lm(formula = mass ~ height, data = .)
## 
## Coefficients:
## (Intercept)       height  
##     -116.58         1.11
```

---

class: center, middle

# Data wrangling

---

## Bike crashes in NC 2007 - 2014

The dataset is in the **dsbox** package:

- github packages require special install commands
- the **remotes** package is automatically installed with **devtools**


```r
install.packages("devtools")
remotes::install_github("rstudio-education/dsbox")

library(dsbox)
ncbikecrash
```

---

## Variables

View the names of variables via

```r
names(ncbikecrash)
```

```
##  [1] "object_id"                       "city"                           
##  [3] "county"                          "region"                         
##  [5] "development"                     "locality"                       
##  [7] "on_road"                         "rural_urban"                    
##  [9] "speed_limit"                     "traffic_control"                
## [11] "weather"                         "workzone"                       
## [13] "bike_age"                        "bike_age_group"                 
## [15] "bike_alcohol"                    "bike_alcohol_drugs"             
## [17] "bike_direction"                  "bike_injury"                    
## [19] "bike_position"                   "bike_race"                      
## [21] "bike_sex"                        "driver_age"                     
## [23] "driver_age_group"                "driver_alcohol"                 
## [25] "driver_alcohol_drugs"            "driver_est_speed"               
## [27] "driver_injury"                   "driver_race"                    
## [29] "driver_sex"                      "driver_vehicle_type"            
## [31] "crash_alcohol"                   "crash_date"                     
## [33] "crash_day"                       "crash_group"                    
## [35] "crash_hour"                      "crash_location"                 
## [37] "crash_month"                     "crash_severity"                 
## [39] "crash_time"                      "crash_type"                     
## [41] "crash_year"                      "ambulance_req"                  
## [43] "hit_run"                         "light_condition"                
## [45] "road_character"                  "road_class"                     
## [47] "road_condition"                  "road_configuration"             
## [49] "road_defects"                    "road_feature"                   
## [51] "road_surface"                    "num_bikes_ai"                   
## [53] "num_bikes_bi"                    "num_bikes_ci"                   
## [55] "num_bikes_ki"                    "num_bikes_no"                   
## [57] "num_bikes_to"                    "num_bikes_ui"                   
## [59] "num_lanes"                       "num_units"                      
## [61] "distance_mi_from"                "frm_road"                       
## [63] "rte_invd_cd"                     "towrd_road"                     
## [65] "geo_point"                       "geo_shape"                      
## [67] "driver_alcohol_drugs_simplified"
```

and see detailed descriptions with `?ncbikecrash`.

---

## Viewing your data

- In the Environment, after loading with `data(ncbikecrash)`, and click on the 
name of the data frame to view it in the data viewer
- Use the `glimpse` function to take a peek


```r
glimpse(ncbikecrash)
```

```
## Observations: 7,467
## Variables: 67
## $ object_id                       &lt;int&gt; 1686, 1674, 1673, 1687, 1653, 16‚Ä¶
## $ city                            &lt;chr&gt; "None - Rural Crash", "Henderson‚Ä¶
## $ county                          &lt;chr&gt; "Wayne", "Vance", "Lincoln", "Co‚Ä¶
## $ region                          &lt;chr&gt; "Coastal", "Piedmont", "Piedmont‚Ä¶
## $ development                     &lt;chr&gt; "Farms, Woods, Pastures", "Resid‚Ä¶
## $ locality                        &lt;chr&gt; "Rural (&lt;30% Developed)", "Mixed‚Ä¶
## $ on_road                         &lt;chr&gt; "SR 1915", "NICHOLAS ST", "US 32‚Ä¶
## $ rural_urban                     &lt;chr&gt; "Rural", "Urban", "Rural", "Urba‚Ä¶
## $ speed_limit                     &lt;chr&gt; "50 - 55  MPH", "30 - 35  MPH", ‚Ä¶
## $ traffic_control                 &lt;chr&gt; "No Control Present", "Stop Sign‚Ä¶
## $ weather                         &lt;chr&gt; "Clear", "Clear", "Clear", "Rain‚Ä¶
## $ workzone                        &lt;chr&gt; "No", "No", "No", "No", "No", "N‚Ä¶
## $ bike_age                        &lt;chr&gt; "52", "66", "33", "52", "22", "1‚Ä¶
## $ bike_age_group                  &lt;chr&gt; "50-59", "60-69", "30-39", "50-5‚Ä¶
## $ bike_alcohol                    &lt;chr&gt; "No", "No", "No", "Yes", "No", "‚Ä¶
## $ bike_alcohol_drugs              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, ‚Ä¶
## $ bike_direction                  &lt;chr&gt; "With Traffic", "With Traffic", ‚Ä¶
## $ bike_injury                     &lt;chr&gt; "B: Evident Injury", "C: Possibl‚Ä¶
## $ bike_position                   &lt;chr&gt; "Bike Lane / Paved Shoulder", "T‚Ä¶
## $ bike_race                       &lt;chr&gt; "Black", "Black", "White", "Blac‚Ä¶
## $ bike_sex                        &lt;chr&gt; "Male", "Male", "Male", "Male", ‚Ä¶
## $ driver_age                      &lt;chr&gt; "34", NA, "37", "55", "25", "17"‚Ä¶
## $ driver_age_group                &lt;chr&gt; "30-39", NA, "30-39", "50-59", "‚Ä¶
## $ driver_alcohol                  &lt;chr&gt; "No", "Missing", "No", "No", "No‚Ä¶
## $ driver_alcohol_drugs            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, ‚Ä¶
## $ driver_est_speed                &lt;chr&gt; "51-55 mph", "6-10 mph", "41-45 ‚Ä¶
## $ driver_injury                   &lt;chr&gt; "O: No Injury", "Unknown Injury"‚Ä¶
## $ driver_race                     &lt;chr&gt; "White", "Unknown/Missing", "His‚Ä¶
## $ driver_sex                      &lt;chr&gt; "Male", NA, "Female", "Male", "M‚Ä¶
## $ driver_vehicle_type             &lt;chr&gt; "Single Unit Truck (2-Axle, 6-Ti‚Ä¶
## $ crash_alcohol                   &lt;chr&gt; "No", "No", "No", "Yes", "No", "‚Ä¶
## $ crash_date                      &lt;chr&gt; "11DEC2013", "20NOV2013", "03NOV‚Ä¶
## $ crash_day                       &lt;chr&gt; "Wednesday", "Wednesday", "Sunda‚Ä¶
## $ crash_group                     &lt;chr&gt; "Motorist Overtaking Bicyclist",‚Ä¶
## $ crash_hour                      &lt;int&gt; 6, 20, 18, 18, 13, 17, 17, 7, 15‚Ä¶
## $ crash_location                  &lt;chr&gt; "Non-Intersection", "Intersectio‚Ä¶
## $ crash_month                     &lt;chr&gt; "December", "November", "Novembe‚Ä¶
## $ crash_severity                  &lt;chr&gt; "B: Evident Injury", "C: Possibl‚Ä¶
## $ crash_time                      &lt;drtn&gt; 06:10:00, 20:41:00, 18:05:00, 1‚Ä¶
## $ crash_type                      &lt;chr&gt; "Motorist Overtaking - Undetecte‚Ä¶
## $ crash_year                      &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 20‚Ä¶
## $ ambulance_req                   &lt;chr&gt; "Yes", "No", "Yes", "Yes", "Yes"‚Ä¶
## $ hit_run                         &lt;chr&gt; "No", "Yes", "No", "No", "No", "‚Ä¶
## $ light_condition                 &lt;chr&gt; "Dark - Roadway Not Lighted", NA‚Ä¶
## $ road_character                  &lt;chr&gt; "Straight - Level", "Straight - ‚Ä¶
## $ road_class                      &lt;chr&gt; "State Secondary Route", "Local ‚Ä¶
## $ road_condition                  &lt;chr&gt; "Dry", "Dry", "Dry", "Water (Sta‚Ä¶
## $ road_configuration              &lt;chr&gt; "Two-Way, Not Divided", "Two-Way‚Ä¶
## $ road_defects                    &lt;chr&gt; "None", NA, "None", "None", "Non‚Ä¶
## $ road_feature                    &lt;chr&gt; "No Special Feature", "T-Interse‚Ä¶
## $ road_surface                    &lt;chr&gt; "Coarse Asphalt", "Smooth Asphal‚Ä¶
## $ num_bikes_ai                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_bikes_bi                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_bikes_ci                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_bikes_ki                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_bikes_no                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_bikes_to                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_bikes_ui                    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ num_lanes                       &lt;chr&gt; "2 lanes", "2 lanes", "2 lanes",‚Ä¶
## $ num_units                       &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,‚Ä¶
## $ distance_mi_from                &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0‚Ä¶
## $ frm_road                        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, ‚Ä¶
## $ rte_invd_cd                     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶
## $ towrd_road                      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, ‚Ä¶
## $ geo_point                       &lt;chr&gt; "35.3336070056, -77.9955023901",‚Ä¶
## $ geo_shape                       &lt;chr&gt; "{\"type\": \"Point\", \"coordin‚Ä¶
## $ driver_alcohol_drugs_simplified &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, ‚Ä¶
```

---

## A Grammar of Data Manipulation

**dplyr** is based on the concepts of functions as verbs that manipulate data frames.

.pull-left[
![](img/dplyr-part-of-tidyverse.png)
]
.pull-right[
.midi[
- `filter`: pick rows matching criteria
- `slice`: pick rows using index(es)
- `select`: pick columns by name
- `pull`: grab a column as a vector
- `arrange`: reorder rows
- `mutate`: add new variables
- `distinct`: filter for unique rows
- `sample_n` / `sample_frac`: randomly sample rows
- `summarise`: reduce variables to values
- ... (many more)
]
]

---

## **dplyr** rules for functions

- First argument is *always* a data frame
- Subsequent arguments say what to do with that data frame
- Always return a data frame
- Don't modify in place

---

## A note on piping and layering

- The `%&gt;%` operator in **dplyr** functions is called the pipe operator. This means you "pipe" the output of the previous line of code as the first input of the next line of code.
- The `+` operator in **ggplot2** functions is used for "layering". This means you create the plot in layers, separated by `+`.

---

## `filter` to select a subset of rows

for crashes in Durham County


```r
ncbikecrash %&gt;%
* filter(county == "Durham")
```

```
## # A tibble: 340 x 67
##    object_id city  county region development locality on_road rural_urban
##        &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      
##  1      2452 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
##  2      2441 Durh‚Ä¶ Durham Piedm‚Ä¶ Commercial  Urban (‚Ä¶ &lt;NA&gt;    Urban      
##  3      2466 Durh‚Ä¶ Durham Piedm‚Ä¶ Commercial  Urban (‚Ä¶ &lt;NA&gt;    Urban      
##  4       549 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ PARK A‚Ä¶ Urban      
##  5       598 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ BELT S‚Ä¶ Urban      
##  6       603 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ HINSON‚Ä¶ Urban      
##  7      3974 Durh‚Ä¶ Durham Piedm‚Ä¶ Commercial  Urban (‚Ä¶ &lt;NA&gt;    Urban      
##  8      7134 Durh‚Ä¶ Durham Piedm‚Ä¶ Commercial  Urban (‚Ä¶ &lt;NA&gt;    Urban      
##  9      1670 Durh‚Ä¶ Durham Piedm‚Ä¶ Commercial  Urban (‚Ä¶ INFINI‚Ä¶ Urban      
## 10      1773 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
## # ‚Ä¶ with 330 more rows, and 59 more variables: speed_limit &lt;chr&gt;,
## #   traffic_control &lt;chr&gt;, weather &lt;chr&gt;, workzone &lt;chr&gt;, bike_age &lt;chr&gt;,
## #   bike_age_group &lt;chr&gt;, bike_alcohol &lt;chr&gt;, bike_alcohol_drugs &lt;chr&gt;,
## #   bike_direction &lt;chr&gt;, bike_injury &lt;chr&gt;, bike_position &lt;chr&gt;,
## #   bike_race &lt;chr&gt;, bike_sex &lt;chr&gt;, driver_age &lt;chr&gt;,
## #   driver_age_group &lt;chr&gt;, driver_alcohol &lt;chr&gt;,
## #   driver_alcohol_drugs &lt;chr&gt;, driver_est_speed &lt;chr&gt;,
## #   driver_injury &lt;chr&gt;, driver_race &lt;chr&gt;, driver_sex &lt;chr&gt;,
## #   driver_vehicle_type &lt;chr&gt;, crash_alcohol &lt;chr&gt;, crash_date &lt;chr&gt;,
## #   crash_day &lt;chr&gt;, crash_group &lt;chr&gt;, crash_hour &lt;int&gt;,
## #   crash_location &lt;chr&gt;, crash_month &lt;chr&gt;, crash_severity &lt;chr&gt;,
## #   crash_time &lt;drtn&gt;, crash_type &lt;chr&gt;, crash_year &lt;int&gt;,
## #   ambulance_req &lt;chr&gt;, hit_run &lt;chr&gt;, light_condition &lt;chr&gt;,
## #   road_character &lt;chr&gt;, road_class &lt;chr&gt;, road_condition &lt;chr&gt;,
## #   road_configuration &lt;chr&gt;, road_defects &lt;chr&gt;, road_feature &lt;chr&gt;,
## #   road_surface &lt;chr&gt;, num_bikes_ai &lt;int&gt;, num_bikes_bi &lt;int&gt;,
## #   num_bikes_ci &lt;int&gt;, num_bikes_ki &lt;int&gt;, num_bikes_no &lt;int&gt;,
## #   num_bikes_to &lt;int&gt;, num_bikes_ui &lt;int&gt;, num_lanes &lt;chr&gt;,
## #   num_units &lt;int&gt;, distance_mi_from &lt;chr&gt;, frm_road &lt;chr&gt;,
## #   rte_invd_cd &lt;int&gt;, towrd_road &lt;chr&gt;, geo_point &lt;chr&gt;, geo_shape &lt;chr&gt;,
## #   driver_alcohol_drugs_simplified &lt;chr&gt;
```

---

## `filter` for many conditions at once

for crashes in Durham County where biker was 0-5 years old


```r
ncbikecrash %&gt;%
  filter(county == "Durham", bike_age_group == "0-5")
```

```
## # A tibble: 4 x 67
##   object_id city  county region development locality on_road rural_urban
##       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      
## 1      4062 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
## 2       414 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ PVA 90‚Ä¶ Urban      
## 3      3016 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
## 4      1383 Durh‚Ä¶ Durham Piedm‚Ä¶ Residential Urban (‚Ä¶ PVA 62‚Ä¶ Urban      
## # ‚Ä¶ with 59 more variables: speed_limit &lt;chr&gt;, traffic_control &lt;chr&gt;,
## #   weather &lt;chr&gt;, workzone &lt;chr&gt;, bike_age &lt;chr&gt;, bike_age_group &lt;chr&gt;,
## #   bike_alcohol &lt;chr&gt;, bike_alcohol_drugs &lt;chr&gt;, bike_direction &lt;chr&gt;,
## #   bike_injury &lt;chr&gt;, bike_position &lt;chr&gt;, bike_race &lt;chr&gt;,
## #   bike_sex &lt;chr&gt;, driver_age &lt;chr&gt;, driver_age_group &lt;chr&gt;,
## #   driver_alcohol &lt;chr&gt;, driver_alcohol_drugs &lt;chr&gt;,
## #   driver_est_speed &lt;chr&gt;, driver_injury &lt;chr&gt;, driver_race &lt;chr&gt;,
## #   driver_sex &lt;chr&gt;, driver_vehicle_type &lt;chr&gt;, crash_alcohol &lt;chr&gt;,
## #   crash_date &lt;chr&gt;, crash_day &lt;chr&gt;, crash_group &lt;chr&gt;,
## #   crash_hour &lt;int&gt;, crash_location &lt;chr&gt;, crash_month &lt;chr&gt;,
## #   crash_severity &lt;chr&gt;, crash_time &lt;drtn&gt;, crash_type &lt;chr&gt;,
## #   crash_year &lt;int&gt;, ambulance_req &lt;chr&gt;, hit_run &lt;chr&gt;,
## #   light_condition &lt;chr&gt;, road_character &lt;chr&gt;, road_class &lt;chr&gt;,
## #   road_condition &lt;chr&gt;, road_configuration &lt;chr&gt;, road_defects &lt;chr&gt;,
## #   road_feature &lt;chr&gt;, road_surface &lt;chr&gt;, num_bikes_ai &lt;int&gt;,
## #   num_bikes_bi &lt;int&gt;, num_bikes_ci &lt;int&gt;, num_bikes_ki &lt;int&gt;,
## #   num_bikes_no &lt;int&gt;, num_bikes_to &lt;int&gt;, num_bikes_ui &lt;int&gt;,
## #   num_lanes &lt;chr&gt;, num_units &lt;int&gt;, distance_mi_from &lt;chr&gt;,
## #   frm_road &lt;chr&gt;, rte_invd_cd &lt;int&gt;, towrd_road &lt;chr&gt;, geo_point &lt;chr&gt;,
## #   geo_shape &lt;chr&gt;, driver_alcohol_drugs_simplified &lt;chr&gt;
```

---

## Logical operators in R

operator    | definition                   || operator     | definition
------------|------------------------------||--------------|----------------
`&lt;`         | less than                    ||`x`&amp;nbsp;&amp;#124;&amp;nbsp;`y`     | `x` OR `y` 
`&lt;=`        |	less than or equal to        ||`is.na(x)`    | test if `x` is `NA`
`&gt;`         | greater than                 ||`!is.na(x)`   | test if `x` is not `NA`
`&gt;=`        |	greater than or equal to     ||`x %in% y`    | test if `x` is in `y`
`==`        |	exactly equal to             ||`!(x %in% y)` | test if `x` is not in `y`
`!=`        |	not equal to                 ||`!x`          | not `x`
`x &amp; y`     | `x` AND `y`                  ||              |

---

## `select` to keep variables


```r
ncbikecrash %&gt;%
  filter(county == "Durham", bike_age_group == "0-5") %&gt;%
  select(locality, speed_limit)
```

```
## # A tibble: 4 x 2
##   locality               speed_limit 
##   &lt;chr&gt;                  &lt;chr&gt;       
## 1 Urban (&gt;70% Developed) 30 - 35  MPH
## 2 Urban (&gt;70% Developed) 5 - 15 MPH  
## 3 Urban (&gt;70% Developed) 20 - 25  MPH
## 4 Urban (&gt;70% Developed) 20 - 25  MPH
```

---

## `select` to exclude variables


```r
ncbikecrash %&gt;%
  select(-object_id)
```

```
## # A tibble: 7,467 x 66
##    city  county region development locality on_road rural_urban speed_limit
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;      
##  1 None‚Ä¶ Wayne  Coast‚Ä¶ Farms, Woo‚Ä¶ Rural (‚Ä¶ SR 1915 Rural       50 - 55  M‚Ä¶
##  2 Hend‚Ä¶ Vance  Piedm‚Ä¶ Residential Mixed (‚Ä¶ NICHOL‚Ä¶ Urban       30 - 35  M‚Ä¶
##  3 None‚Ä¶ Linco‚Ä¶ Piedm‚Ä¶ Farms, Woo‚Ä¶ Rural (‚Ä¶ US 321  Rural       50 - 55  M‚Ä¶
##  4 Whit‚Ä¶ Colum‚Ä¶ Coast‚Ä¶ Commercial  Urban (‚Ä¶ W BURK‚Ä¶ Urban       30 - 35  M‚Ä¶
##  5 Wilm‚Ä¶ New H‚Ä¶ Coast‚Ä¶ Residential Urban (‚Ä¶ RACINE‚Ä¶ Urban       &lt;NA&gt;       
##  6 None‚Ä¶ Robes‚Ä¶ Coast‚Ä¶ Farms, Woo‚Ä¶ Rural (‚Ä¶ SR 1513 Rural       50 - 55  M‚Ä¶
##  7 None‚Ä¶ Richm‚Ä¶ Piedm‚Ä¶ Residential Mixed (‚Ä¶ SR 1903 Rural       30 - 35  M‚Ä¶
##  8 Rale‚Ä¶ Wake   Piedm‚Ä¶ Commercial  Urban (‚Ä¶ PERSON‚Ä¶ Urban       30 - 35  M‚Ä¶
##  9 Whit‚Ä¶ Colum‚Ä¶ Coast‚Ä¶ Residential Rural (‚Ä¶ FLOWER‚Ä¶ Urban       30 - 35  M‚Ä¶
## 10 New ‚Ä¶ Craven Coast‚Ä¶ Residential Urban (‚Ä¶ SUTTON‚Ä¶ Urban       20 - 25  M‚Ä¶
## # ‚Ä¶ with 7,457 more rows, and 58 more variables: traffic_control &lt;chr&gt;,
## #   weather &lt;chr&gt;, workzone &lt;chr&gt;, bike_age &lt;chr&gt;, bike_age_group &lt;chr&gt;,
## #   bike_alcohol &lt;chr&gt;, bike_alcohol_drugs &lt;chr&gt;, bike_direction &lt;chr&gt;,
## #   bike_injury &lt;chr&gt;, bike_position &lt;chr&gt;, bike_race &lt;chr&gt;,
## #   bike_sex &lt;chr&gt;, driver_age &lt;chr&gt;, driver_age_group &lt;chr&gt;,
## #   driver_alcohol &lt;chr&gt;, driver_alcohol_drugs &lt;chr&gt;,
## #   driver_est_speed &lt;chr&gt;, driver_injury &lt;chr&gt;, driver_race &lt;chr&gt;,
## #   driver_sex &lt;chr&gt;, driver_vehicle_type &lt;chr&gt;, crash_alcohol &lt;chr&gt;,
## #   crash_date &lt;chr&gt;, crash_day &lt;chr&gt;, crash_group &lt;chr&gt;,
## #   crash_hour &lt;int&gt;, crash_location &lt;chr&gt;, crash_month &lt;chr&gt;,
## #   crash_severity &lt;chr&gt;, crash_time &lt;drtn&gt;, crash_type &lt;chr&gt;,
## #   crash_year &lt;int&gt;, ambulance_req &lt;chr&gt;, hit_run &lt;chr&gt;,
## #   light_condition &lt;chr&gt;, road_character &lt;chr&gt;, road_class &lt;chr&gt;,
## #   road_condition &lt;chr&gt;, road_configuration &lt;chr&gt;, road_defects &lt;chr&gt;,
## #   road_feature &lt;chr&gt;, road_surface &lt;chr&gt;, num_bikes_ai &lt;int&gt;,
## #   num_bikes_bi &lt;int&gt;, num_bikes_ci &lt;int&gt;, num_bikes_ki &lt;int&gt;,
## #   num_bikes_no &lt;int&gt;, num_bikes_to &lt;int&gt;, num_bikes_ui &lt;int&gt;,
## #   num_lanes &lt;chr&gt;, num_units &lt;int&gt;, distance_mi_from &lt;chr&gt;,
## #   frm_road &lt;chr&gt;, rte_invd_cd &lt;int&gt;, towrd_road &lt;chr&gt;, geo_point &lt;chr&gt;,
## #   geo_shape &lt;chr&gt;, driver_alcohol_drugs_simplified &lt;chr&gt;
```

---

## `select` a range of variables


```r
ncbikecrash %&gt;%
  select(city:locality)
```

```
## # A tibble: 7,467 x 5
##    city           county     region  development       locality            
##    &lt;chr&gt;          &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;             &lt;chr&gt;               
##  1 None - Rural ‚Ä¶ Wayne      Coastal Farms, Woods, Pa‚Ä¶ Rural (&lt;30% Develop‚Ä¶
##  2 Henderson      Vance      Piedmo‚Ä¶ Residential       Mixed (30% To 70% D‚Ä¶
##  3 None - Rural ‚Ä¶ Lincoln    Piedmo‚Ä¶ Farms, Woods, Pa‚Ä¶ Rural (&lt;30% Develop‚Ä¶
##  4 Whiteville     Columbus   Coastal Commercial        Urban (&gt;70% Develop‚Ä¶
##  5 Wilmington     New Hanov‚Ä¶ Coastal Residential       Urban (&gt;70% Develop‚Ä¶
##  6 None - Rural ‚Ä¶ Robeson    Coastal Farms, Woods, Pa‚Ä¶ Rural (&lt;30% Develop‚Ä¶
##  7 None - Rural ‚Ä¶ Richmond   Piedmo‚Ä¶ Residential       Mixed (30% To 70% D‚Ä¶
##  8 Raleigh        Wake       Piedmo‚Ä¶ Commercial        Urban (&gt;70% Develop‚Ä¶
##  9 Whiteville     Columbus   Coastal Residential       Rural (&lt;30% Develop‚Ä¶
## 10 New Bern       Craven     Coastal Residential       Urban (&gt;70% Develop‚Ä¶
## # ‚Ä¶ with 7,457 more rows
```

---

## `slice` for certain row numbers

First five

```r
ncbikecrash %&gt;%
  slice(1:5)
```

```
## # A tibble: 5 x 67
##   object_id city  county region development locality on_road rural_urban
##       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      
## 1      1686 None‚Ä¶ Wayne  Coast‚Ä¶ Farms, Woo‚Ä¶ Rural (‚Ä¶ SR 1915 Rural      
## 2      1674 Hend‚Ä¶ Vance  Piedm‚Ä¶ Residential Mixed (‚Ä¶ NICHOL‚Ä¶ Urban      
## 3      1673 None‚Ä¶ Linco‚Ä¶ Piedm‚Ä¶ Farms, Woo‚Ä¶ Rural (‚Ä¶ US 321  Rural      
## 4      1687 Whit‚Ä¶ Colum‚Ä¶ Coast‚Ä¶ Commercial  Urban (‚Ä¶ W BURK‚Ä¶ Urban      
## 5      1653 Wilm‚Ä¶ New H‚Ä¶ Coast‚Ä¶ Residential Urban (‚Ä¶ RACINE‚Ä¶ Urban      
## # ‚Ä¶ with 59 more variables: speed_limit &lt;chr&gt;, traffic_control &lt;chr&gt;,
## #   weather &lt;chr&gt;, workzone &lt;chr&gt;, bike_age &lt;chr&gt;, bike_age_group &lt;chr&gt;,
## #   bike_alcohol &lt;chr&gt;, bike_alcohol_drugs &lt;chr&gt;, bike_direction &lt;chr&gt;,
## #   bike_injury &lt;chr&gt;, bike_position &lt;chr&gt;, bike_race &lt;chr&gt;,
## #   bike_sex &lt;chr&gt;, driver_age &lt;chr&gt;, driver_age_group &lt;chr&gt;,
## #   driver_alcohol &lt;chr&gt;, driver_alcohol_drugs &lt;chr&gt;,
## #   driver_est_speed &lt;chr&gt;, driver_injury &lt;chr&gt;, driver_race &lt;chr&gt;,
## #   driver_sex &lt;chr&gt;, driver_vehicle_type &lt;chr&gt;, crash_alcohol &lt;chr&gt;,
## #   crash_date &lt;chr&gt;, crash_day &lt;chr&gt;, crash_group &lt;chr&gt;,
## #   crash_hour &lt;int&gt;, crash_location &lt;chr&gt;, crash_month &lt;chr&gt;,
## #   crash_severity &lt;chr&gt;, crash_time &lt;drtn&gt;, crash_type &lt;chr&gt;,
## #   crash_year &lt;int&gt;, ambulance_req &lt;chr&gt;, hit_run &lt;chr&gt;,
## #   light_condition &lt;chr&gt;, road_character &lt;chr&gt;, road_class &lt;chr&gt;,
## #   road_condition &lt;chr&gt;, road_configuration &lt;chr&gt;, road_defects &lt;chr&gt;,
## #   road_feature &lt;chr&gt;, road_surface &lt;chr&gt;, num_bikes_ai &lt;int&gt;,
## #   num_bikes_bi &lt;int&gt;, num_bikes_ci &lt;int&gt;, num_bikes_ki &lt;int&gt;,
## #   num_bikes_no &lt;int&gt;, num_bikes_to &lt;int&gt;, num_bikes_ui &lt;int&gt;,
## #   num_lanes &lt;chr&gt;, num_units &lt;int&gt;, distance_mi_from &lt;chr&gt;,
## #   frm_road &lt;chr&gt;, rte_invd_cd &lt;int&gt;, towrd_road &lt;chr&gt;, geo_point &lt;chr&gt;,
## #   geo_shape &lt;chr&gt;, driver_alcohol_drugs_simplified &lt;chr&gt;
```

---

## `slice` for certain row numbers

Last five

```r
last_row &lt;- nrow(ncbikecrash)
ncbikecrash %&gt;%
  slice((last_row - 4):last_row)
```

```
## # A tibble: 5 x 67
##   object_id city  county region development locality on_road rural_urban
##       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;      
## 1      6989 High‚Ä¶ Guilf‚Ä¶ Piedm‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
## 2      6991 Wilm‚Ä¶ New H‚Ä¶ Coast‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
## 3      6995 Kins‚Ä¶ Lenoir Coast‚Ä¶ Commercial  Urban (‚Ä¶ &lt;NA&gt;    Urban      
## 4      6998 Faye‚Ä¶ Cumbe‚Ä¶ Coast‚Ä¶ Residential Urban (‚Ä¶ &lt;NA&gt;    Urban      
## 5      7000 None‚Ä¶ Onslow Coast‚Ä¶ Farms, Woo‚Ä¶ Rural (‚Ä¶ &lt;NA&gt;    Rural      
## # ‚Ä¶ with 59 more variables: speed_limit &lt;chr&gt;, traffic_control &lt;chr&gt;,
## #   weather &lt;chr&gt;, workzone &lt;chr&gt;, bike_age &lt;chr&gt;, bike_age_group &lt;chr&gt;,
## #   bike_alcohol &lt;chr&gt;, bike_alcohol_drugs &lt;chr&gt;, bike_direction &lt;chr&gt;,
## #   bike_injury &lt;chr&gt;, bike_position &lt;chr&gt;, bike_race &lt;chr&gt;,
## #   bike_sex &lt;chr&gt;, driver_age &lt;chr&gt;, driver_age_group &lt;chr&gt;,
## #   driver_alcohol &lt;chr&gt;, driver_alcohol_drugs &lt;chr&gt;,
## #   driver_est_speed &lt;chr&gt;, driver_injury &lt;chr&gt;, driver_race &lt;chr&gt;,
## #   driver_sex &lt;chr&gt;, driver_vehicle_type &lt;chr&gt;, crash_alcohol &lt;chr&gt;,
## #   crash_date &lt;chr&gt;, crash_day &lt;chr&gt;, crash_group &lt;chr&gt;,
## #   crash_hour &lt;int&gt;, crash_location &lt;chr&gt;, crash_month &lt;chr&gt;,
## #   crash_severity &lt;chr&gt;, crash_time &lt;drtn&gt;, crash_type &lt;chr&gt;,
## #   crash_year &lt;int&gt;, ambulance_req &lt;chr&gt;, hit_run &lt;chr&gt;,
## #   light_condition &lt;chr&gt;, road_character &lt;chr&gt;, road_class &lt;chr&gt;,
## #   road_condition &lt;chr&gt;, road_configuration &lt;chr&gt;, road_defects &lt;chr&gt;,
## #   road_feature &lt;chr&gt;, road_surface &lt;chr&gt;, num_bikes_ai &lt;int&gt;,
## #   num_bikes_bi &lt;int&gt;, num_bikes_ci &lt;int&gt;, num_bikes_ki &lt;int&gt;,
## #   num_bikes_no &lt;int&gt;, num_bikes_to &lt;int&gt;, num_bikes_ui &lt;int&gt;,
## #   num_lanes &lt;chr&gt;, num_units &lt;int&gt;, distance_mi_from &lt;chr&gt;,
## #   frm_road &lt;chr&gt;, rte_invd_cd &lt;int&gt;, towrd_road &lt;chr&gt;, geo_point &lt;chr&gt;,
## #   geo_shape &lt;chr&gt;, driver_alcohol_drugs_simplified &lt;chr&gt;
```

---

## `pull` to extract a column as a vector


```r
ncbikecrash %&gt;%
  slice(1:6) %&gt;%
  pull(locality)
```

```
## [1] "Rural (&lt;30% Developed)"       "Mixed (30% To 70% Developed)"
## [3] "Rural (&lt;30% Developed)"       "Urban (&gt;70% Developed)"      
## [5] "Urban (&gt;70% Developed)"       "Rural (&lt;30% Developed)"
```

vs.


```r
ncbikecrash %&gt;%
  slice(1:6) %&gt;%
  select(locality)
```

```
## # A tibble: 6 x 1
##   locality                    
##   &lt;chr&gt;                       
## 1 Rural (&lt;30% Developed)      
## 2 Mixed (30% To 70% Developed)
## 3 Rural (&lt;30% Developed)      
## 4 Urban (&gt;70% Developed)      
## 5 Urban (&gt;70% Developed)      
## 6 Rural (&lt;30% Developed)
```

---

## `sample_n` / `sample_frac` for a random sample

- `sample_n`: randomly sample 5 observations


```r
ncbikecrash_n5 &lt;- ncbikecrash %&gt;%
  sample_n(5, replace = FALSE)
dim(ncbikecrash_n5)
```

```
## [1]  5 67
```

- `sample_frac`: randomly sample 20% of observations


```r
ncbikecrash_perc20 &lt;-ncbikecrash %&gt;%
  sample_frac(0.2, replace = FALSE)
dim(ncbikecrash_perc20)
```

```
## [1] 1493   67
```

---

## `distinct` to filter for unique rows

And `arrange` to order alphabetically


```r
ncbikecrash %&gt;% 
  select(county, city) %&gt;% 
  distinct() %&gt;% 
  arrange(county, city)
```

```
## # A tibble: 391 x 2
##    county    city              
##    &lt;chr&gt;     &lt;chr&gt;             
##  1 Alamance  Alamance          
##  2 Alamance  Burlington        
##  3 Alamance  Elon              
##  4 Alamance  Elon College      
##  5 Alamance  Gibsonville       
##  6 Alamance  Graham            
##  7 Alamance  Green Level       
##  8 Alamance  Mebane            
##  9 Alamance  None - Rural Crash
## 10 Alexander None - Rural Crash
## # ‚Ä¶ with 381 more rows
```

---

## `summarise` to reduce variables to values


```r
ncbikecrash %&gt;%
  summarise(avg_hr = mean(crash_hour))
```

```
## # A tibble: 1 x 1
##   avg_hr
##    &lt;dbl&gt;
## 1   14.7
```

---

## `group_by` to do calculations on groups


```r
ncbikecrash %&gt;%
  group_by(hit_run) %&gt;%
  summarise(avg_hr = mean(crash_hour))
```

```
## # A tibble: 2 x 2
##   hit_run avg_hr
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 No        14.6
## 2 Yes       15.0
```

---

## `count` observations in groups


```r
ncbikecrash %&gt;%
  count(driver_alcohol_drugs)
```

```
## # A tibble: 6 x 2
##   driver_alcohol_drugs                    n
##   &lt;chr&gt;                               &lt;int&gt;
## 1 &lt;NA&gt;                                 6654
## 2 Missing                                99
## 3 No                                    695
## 4 Yes-Alcohol,  impairment suspected     12
## 5 Yes-Alcohol, no impairment detected     3
## 6 Yes-Drugs, impairment suspected         4
```

---

## `mutate` to add new variables


```r
ncbikecrash %&gt;%
  mutate(driver_alcohol_drugs_simplified = case_when(
    driver_alcohol_drugs == "Missing"       ~ NA,
    str_detect(driver_alcohol_drugs, "Yes") ~ "Yes",
    TRUE                                    ~ "No"
  ))
```

---

## "Save" when you `mutate`

Most often when you define a new variable with `mutate` you'll also want to save the resulting data frame, often by writing over the original data frame.


```r
ncbikecrash &lt;- ncbikecrash %&gt;%
  mutate(driver_alcohol_drugs_simplified = case_when(
    str_detect(driver_alcohol_drugs, "Yes") ~ "Yes",
    TRUE                                    ~ driver_alcohol_drugs
  ))
```

---

## Check before you move on


```r
ncbikecrash %&gt;% 
  count(driver_alcohol_drugs, driver_alcohol_drugs_simplified)
```

```
## # A tibble: 6 x 3
##   driver_alcohol_drugs                driver_alcohol_drugs_simplified     n
##   &lt;chr&gt;                               &lt;chr&gt;                           &lt;int&gt;
## 1 &lt;NA&gt;                                &lt;NA&gt;                             6654
## 2 Missing                             Missing                            99
## 3 No                                  No                                695
## 4 Yes-Alcohol,  impairment suspected  Yes                                12
## 5 Yes-Alcohol, no impairment detected Yes                                 3
## 6 Yes-Drugs, impairment suspected     Yes                                 4
```


```r
ncbikecrash %&gt;% 
  count(driver_alcohol_drugs_simplified)
```

```
## # A tibble: 4 x 2
##   driver_alcohol_drugs_simplified     n
##   &lt;chr&gt;                           &lt;int&gt;
## 1 &lt;NA&gt;                             6654
## 2 Missing                            99
## 3 No                                695
## 4 Yes                                19
```

---

## &lt;svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 640 512"&gt;&lt;path d="M512 64v256H128V64h384m16-64H112C85.5 0 64 21.5 64 48v288c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48V48c0-26.5-21.5-48-48-48zm100 416H389.5c-3 0-5.5 2.1-5.9 5.1C381.2 436.3 368 448 352 448h-64c-16 0-29.2-11.7-31.6-26.9-.5-2.9-3-5.1-5.9-5.1H12c-6.6 0-12 5.4-12 12v36c0 26.5 21.5 48 48 48h544c26.5 0 48-21.5 48-48v-36c0-6.6-5.4-12-12-12z"/&gt;&lt;/svg&gt;  AE 04 - NC bike crashes

- Go to the cloud project and open this application exercise
- For each question you work on, set the `eval` chunk option to `TRUE` and knit

---

class: title-slide

# Coding style &lt;br&gt; ü§µ

---

class: center, middle

# Coding style

---

## Style guide

&gt;"Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread."
&gt;
&gt;Hadley Wickham

- Style guide for this course is based on the Tidyverse style guide: http://style.tidyverse.org/
- There's more to it than what we'll cover today, but we'll mention more as we introduce more functionality, and do a recap later in the semester

---

## File names and code chunk labels

- Do not use spaces in file names, use `-` or `_` to separate words
- Use all lowercase letters


```r
# Good
ucb-admit.csv

# Bad
UCB Admit.csv
```

---

## Object names

- Use `_` to separate words in object names
- Use informative but short object names
- Do not reuse object names within an analysis


```r
# Good
acs_employed

# Bad
acs.employed
acs2
acs_subset
acs_subsetted_for_males
```

---

## Spacing

- Put a space before and after all infix operators (=, +, -, &lt;-, etc.), and when naming arguments in function calls. 
- Always put a space after a comma, and never before (just like in regular English).


```r
# Good
average &lt;- mean(feet / 12 + inches, na.rm = TRUE)

# Bad
average&lt;-mean(feet/12+inches,na.rm=TRUE)
```

---

## ggplot

- Always end a line with `+`
- Always indent the next line


```r
# Good
ggplot(diamonds, mapping = aes(x = price)) +
  geom_histogram()

# Bad
ggplot(diamonds,mapping=aes(x=price))+geom_histogram()
```

---

## Long lines

- Limit your code to 80 characters per line. This fits comfortably on a printed page with a reasonably sized font.
- Take advantage of RStudio editor's auto formatting for indentation at line breaks.

---

## Assignment

- Use `&lt;-` not `=`


```r
# Good
x &lt;- 2

# Bad
x = 2
```

---

## Quotes

Use `"`, not `'`, for quoting text. The only exception is when the text already contains double quotes and no single quotes.


```r
ggplot(diamonds, mapping = aes(x = price)) +
  geom_histogram() +
  # Good
  labs(title = "`Shine bright like a diamond`",
  # Good
       x = "Diamond prices",
  # Bad
       y = 'Frequency')
```

---

class: title-slide

# Data classes and types + Recoding &lt;br&gt; üíΩ

---

class: center, middle

# Data classes and types

---

## Data types in R

* **logical**
* **double**
* **integer**
* **character**
* **lists**
* and some more, but we won't be focusing on those

---

## Logical &amp; character

**logical** - boolean values `TRUE` and `FALSE`


```r
typeof(TRUE)
```

```
## [1] "logical"
```

**character** - character strings


```r
typeof("hello")
```

```
## [1] "character"
```

```r
typeof('world') # but remember, we use double quotations!
```

```
## [1] "character"
```

---

## Double &amp; integer

**double** - floating point numerical values (default numerical type)


```r
typeof(1.335)
```

```
## [1] "double"
```

```r
typeof(7)
```

```
## [1] "double"
```

**integer** - integer numerical values (indicated with an `L`)


```r
typeof(7L)
```

```
## [1] "integer"
```

```r
typeof(1:3)
```

```
## [1] "integer"
```

---

## Lists

**Lists** are 1d objects that can contain any combination of R objects

.small[

```r
mylist &lt;- list("A", 1:4, c(TRUE, FALSE), (1:4)/2)
mylist
```

```
## [[1]]
## [1] "A"
## 
## [[2]]
## [1] 1 2 3 4
## 
## [[3]]
## [1]  TRUE FALSE
## 
## [[4]]
## [1] 0.5 1.0 1.5 2.0
```


```r
str(mylist)
```

```
## List of 4
##  $ : chr "A"
##  $ : int [1:4] 1 2 3 4
##  $ : logi [1:2] TRUE FALSE
##  $ : num [1:4] 0.5 1 1.5 2
```
]

---

## Named lists

Because of their more complex structure we often want to name the elements of a list (we 
can also do this with vectors). This can make reading and accessing the list more 
straight forward.

.small[

```r
myotherlist &lt;- list(A = "hello", B = 1:4, "knock knock" = "who's there?")
str(myotherlist)
```

```
## List of 3
##  $ A          : chr "hello"
##  $ B          : int [1:4] 1 2 3 4
##  $ knock knock: chr "who's there?"
```

```r
names(myotherlist)
```

```
## [1] "A"           "B"           "knock knock"
```

```r
myotherlist$B
```

```
## [1] 1 2 3 4
```
]

---

## Concatenation

Vectors can be constructed using the `c()` function.


```r
c(1, 2, 3)
```

```
## [1] 1 2 3
```

```r
c("Hello", "World!")
```

```
## [1] "Hello"  "World!"
```

```r
c(1, c(2, c(3)))
```

```
## [1] 1 2 3
```

---

## Coercion

R is a dynamically typed language -- it will happily convert between the various types 
without complaint.


```r
c(1, "Hello")
```

```
## [1] "1"     "Hello"
```

```r
c(FALSE, 3L)
```

```
## [1] 0 3
```

```r
c(1.2, 3L)
```

```
## [1] 1.2 3.0
```

---

## Missing Values

R uses `NA` to represent missing values in its data structures.


```r
typeof(NA)
```

```
## [1] "logical"
```

---

## Other Special Values

`NaN` - Not a number

`Inf` - Positive infinity

`-Inf` - Negative infinity

&lt;br/&gt;

.pull-left[

```r
pi / 0
```

```
## [1] Inf
```

```r
0 / 0
```

```
## [1] NaN
```

```r
1/0 + 1/0
```

```
## [1] Inf
```
]
.pull-right[

```r
1/0 - 1/0
```

```
## [1] NaN
```

```r
NaN / NA
```

```
## [1] NaN
```

```r
NaN * NA
```

```
## [1] NaN
```
]

---

## Activity

.question[
What is the type of the following vectors? Explain why they have that type.
]

* `c(1, NA+1L, "C")`
* `c(1L / 0, NA)`
* `c(1:3, 5)`
* `c(3L, NaN+1L)`
* `c(NA, TRUE)`

---

## Example: Cat lovers

A survey asked respondents their name and number of cats. The instructions said to enter the number of cats as a numerical value.

.small[

```r
cat_lovers &lt;- read_csv("../data/cat-lovers.csv")
```

<div id="htmlwidget-5c03262fbbfcf64ff186" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5c03262fbbfcf64ff186">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],["Bernice Warren","Woodrow Stone","Willie Bass","Tyrone Estrada","Alex Daniels","Jane Bates","Latoya Simpson","Darin Woods","Agnes Cobb","Tabitha Grant","Perry Cross","Wanda Silva","Alicia Sims","Emily Logan","Woodrow Elliott","Brent Copeland","Pedro Carlson","Patsy Luna","Brett Robbins","Oliver George","Calvin Perry","Lora Gutierrez","Charlotte Sparks","Earl Mack","Leslie Wade","Santiago Barker","Jose Bell","Lynda Smith","Bradford Marshall","Irving Miller","Caroline Simpson","Frances Welch","Melba Jenkins","Veronica Morales","Juanita Cunningham","Maurice Howard","Teri Pierce","Phil Franklin","Jan Zimmerman","Leslie Price","Bessie Patterson","Ethel Wolfe","Naomi Wright","Sadie Frank","Lonnie Cannon","Tony Garcia","Darla Newton","Ginger Clark","Lionel Campbell","Florence Klein","Harriet Leonard","Terrence Harrington","Travis Garner","Doug Bass","Pat Norris","Dawn Young","Shari Alvarez","Tamara Robinson","Megan Morgan","Kara Obrien"],["0","0","1","3","3","2","1","1","0","0","0","0","1","3","3","2","1","1","0","0","1","1","0","0","4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","1","3","3","2","1","1.5 - honestly I think one of my cats is half human","0","0","0","0","1","three","1","1","1","0","0","2"],["left","left","left","left","left","left","left","left","left","left","left","left","left","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","ambidextrous","ambidextrous","ambidextrous","ambidextrous","ambidextrous"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>number_of_cats<\/th>\n      <th>handedness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
]

---

## Oh why won't you work?!


```r
cat_lovers %&gt;%
  summarise(mean = mean(number_of_cats))
```

```
## Warning in mean.default(number_of_cats): argument is not numeric or
## logical: returning NA
```

```
## # A tibble: 1 x 1
##    mean
##   &lt;dbl&gt;
## 1    NA
```

---

## Oh why won't you still work??!!


```r
cat_lovers %&gt;%
  summarise(mean_cats = mean(number_of_cats, na.rm = TRUE))
```

```
## Warning in mean.default(number_of_cats, na.rm = TRUE): argument is not
## numeric or logical: returning NA
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1        NA
```

---

## Take a breath and look at your data

.question[
What is the type of the `number_of_cats` variable?
]


```r
glimpse(cat_lovers)
```

```
## Observations: 60
## Variables: 3
## $ name           &lt;chr&gt; "Bernice Warren", "Woodrow Stone", "Willie Bass",‚Ä¶
## $ number_of_cats &lt;chr&gt; "0", "0", "1", "3", "3", "2", "1", "1", "0", "0",‚Ä¶
## $ handedness     &lt;chr&gt; "left", "left", "left", "left", "left", "left", "‚Ä¶
```

---

## Let's take another look

.small[
<div id="htmlwidget-ff322964a2c6e1541bfa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff322964a2c6e1541bfa">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],["Bernice Warren","Woodrow Stone","Willie Bass","Tyrone Estrada","Alex Daniels","Jane Bates","Latoya Simpson","Darin Woods","Agnes Cobb","Tabitha Grant","Perry Cross","Wanda Silva","Alicia Sims","Emily Logan","Woodrow Elliott","Brent Copeland","Pedro Carlson","Patsy Luna","Brett Robbins","Oliver George","Calvin Perry","Lora Gutierrez","Charlotte Sparks","Earl Mack","Leslie Wade","Santiago Barker","Jose Bell","Lynda Smith","Bradford Marshall","Irving Miller","Caroline Simpson","Frances Welch","Melba Jenkins","Veronica Morales","Juanita Cunningham","Maurice Howard","Teri Pierce","Phil Franklin","Jan Zimmerman","Leslie Price","Bessie Patterson","Ethel Wolfe","Naomi Wright","Sadie Frank","Lonnie Cannon","Tony Garcia","Darla Newton","Ginger Clark","Lionel Campbell","Florence Klein","Harriet Leonard","Terrence Harrington","Travis Garner","Doug Bass","Pat Norris","Dawn Young","Shari Alvarez","Tamara Robinson","Megan Morgan","Kara Obrien"],["0","0","1","3","3","2","1","1","0","0","0","0","1","3","3","2","1","1","0","0","1","1","0","0","4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","1","3","3","2","1","1.5 - honestly I think one of my cats is half human","0","0","0","0","1","three","1","1","1","0","0","2"],["left","left","left","left","left","left","left","left","left","left","left","left","left","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","ambidextrous","ambidextrous","ambidextrous","ambidextrous","ambidextrous"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>number_of_cats<\/th>\n      <th>handedness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
]

---

## Sometimes you need to babysit your respondents


```r
cat_lovers %&gt;%
  mutate(number_of_cats = case_when(
    name == "Ginger Clark" ~ 2,
    name == "Doug Bass"    ~ 3,
    TRUE                   ~ as.numeric(number_of_cats)
    )) %&gt;%
  summarise(mean_cats = mean(number_of_cats))
```

```
## Warning in eval_tidy(pair$rhs, env = default_env): NAs introduced by
## coercion
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.817
```

---

## Always you need to respect data types


```r
cat_lovers %&gt;%
  mutate(
    number_of_cats = case_when(
      name == "Ginger Clark" ~ "2",
      name == "Doug Bass"    ~ "3",
      TRUE                   ~ number_of_cats
      ),
    number_of_cats = as.numeric(number_of_cats)
    ) %&gt;%
  summarise(mean_cats = mean(number_of_cats))
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.817
```

---

## Now that we know what we're doing...


```r
cat_lovers &lt;- cat_lovers %&gt;%
  mutate(
    number_of_cats = case_when(
      name == "Ginger Clark" ~ "2",
      name == "Doug Bass"    ~ "3",
      TRUE                   ~ number_of_cats
      ),
    number_of_cats = as.numeric(number_of_cats)
    )
```

---

## Moral of the story

- If your data does not behave how you expect it to, type coercion upon reading in the data might be the reason.
- Go in and investigate your data, apply the fix, *save your data*, live happily ever after.

---

## Vectors vs. lists

.pull-left[
.small[

```r
x &lt;- c(8,4,7)
```
]
.small[

```r
x[1]
```

```
## [1] 8
```
]
.small[

```r
x[[1]]
```

```
## [1] 8
```
]
]
--
.pull-right[
.small[

```r
y &lt;- list(8,4,7)
```
]
.small[

```r
y[2]
```

```
## [[1]]
## [1] 4
```
]
.small[

```r
y[[2]]
```

```
## [1] 4
```
]
]

--

&lt;br&gt;

**Note:** When using tidyverse code you'll rarely need to refer to elements using square brackets, but it's good to be aware of this syntax, especially since you might encounter it when searching for help online.

---

class: center, middle

# Data "set"

---

## Data "sets" in R

- "set" is in quotation marks because it is not a formal data class
- A tidy data "set" can be one of the following types:
    + `tibble`
    + `data.frame`
- We'll often work with `tibble`s:
    + `readr` package (e.g. `read_csv` function) loads data as a `tibble` by default
    + `tibble`s are part of the tidyverse, so they work well with other packages we are using
    + they make minimal assumptions about your data, so are less likely to cause hard to track bugs in your code

---

## Data frames

- A data frame is the most commonly used data structure in R, they are just a list of equal length vectors (usually atomic, but you can use generic as well). Each vector is treated as a column and elements of the vectors as rows.
- A tibble is a type of data frame that ... makes your life (i.e. data analysis) easier.
- Most often a data frame will be constructed by reading in from a file, but we can also create them from scratch.


```r
df &lt;- tibble(x = 1:3, y = c("a", "b", "c"))
class(df)
```

```
## [1] "tbl_df"     "tbl"        "data.frame"
```

```r
glimpse(df)
```

```
## Observations: 3
## Variables: 2
## $ x &lt;int&gt; 1, 2, 3
## $ y &lt;chr&gt; "a", "b", "c"
```

---

## Data frames (cont.)


```r
attributes(df)
```

```
## $names
## [1] "x" "y"
## 
## $row.names
## [1] 1 2 3
## 
## $class
## [1] "tbl_df"     "tbl"        "data.frame"
```

```r
class(df$x)
```

```
## [1] "integer"
```

```r
class(df$y)
```

```
## [1] "character"
```

---

## Working with tibbles in pipelines

.question[
How many respondents have below average number of cats?
]


```r
mean_cats &lt;- cat_lovers %&gt;%
  summarise(mean_cats = mean(number_of_cats))

cat_lovers %&gt;%
  filter(number_of_cats &lt; mean_cats) %&gt;%
  nrow()
```

```
## [1] 60
```

.question[
Do you believe this number? Why, why not?
]

---

## A result of a pipeline is always a tibble


```r
mean_cats
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.817
```

```r
class(mean_cats)
```

```
## [1] "tbl_df"     "tbl"        "data.frame"
```

---

## `pull()` can be your new best friend

But use it sparingly!


```r
mean_cats &lt;- cat_lovers %&gt;%
  summarise(mean_cats = mean(number_of_cats)) %&gt;%
  pull()

cat_lovers %&gt;%
  filter(number_of_cats &lt; mean_cats) %&gt;%
  nrow()
```

```
## [1] 33
```

--


```r
mean_cats
```

```
## [1] 0.8166667
```

```r
class(mean_cats)
```

```
## [1] "numeric"
```

---

class: center, middle

# Factors

---

## Factors

Factor objects are how R stores data for categorical variables (fixed numbers of discrete values).


```r
(x = factor(c("BS", "MS", "PhD", "MS")))
```

```
## [1] BS  MS  PhD MS 
## Levels: BS MS PhD
```


```r
glimpse(x)
```

```
##  Factor w/ 3 levels "BS","MS","PhD": 1 2 3 2
```


```r
typeof(x)
```

```
## [1] "integer"
```

---

## Read data in as character strings


```r
glimpse(cat_lovers)
```

```
## Observations: 60
## Variables: 3
## $ name           &lt;chr&gt; "Bernice Warren", "Woodrow Stone", "Willie Bass",‚Ä¶
## $ number_of_cats &lt;dbl&gt; 0, 0, 1, 3, 3, 2, 1, 1, 0, 0, 0, 0, 1, 3, 3, 2, 1‚Ä¶
## $ handedness     &lt;chr&gt; "left", "left", "left", "left", "left", "left", "‚Ä¶
```

---

## But coerce when plotting


```r
ggplot(cat_lovers, mapping = aes(x = handedness)) +
  geom_bar()
```

![](index_files/figure-html/unnamed-chunk-82-1.png)&lt;!-- --&gt;

---

## Use forcats to manipulate factors


```r
cat_lovers &lt;- cat_lovers %&gt;%
  mutate(handedness = fct_relevel(handedness, 
                                  "right", "left", "ambidextrous"))
```


```r
ggplot(cat_lovers, mapping = aes(x = handedness)) +
  geom_bar()
```

![](index_files/figure-html/unnamed-chunk-84-1.png)&lt;!-- --&gt;

---

## Come for the functionality

.pull-left[
... stay for the logo
]
.pull-right[
![](img/hex-forcats.png)
]

- R uses factors to handle categorical variables, variables that have a fixed and known set of possible values. Historically, factors were much easier to work with than character vectors, so many base R functions automatically convert character vectors to factors.
- However, factors are still useful when you have true categorical data, and when you want to override the ordering of character vectors to improve display. The goal of the forcats package is to provide a suite of useful tools that solve common problems with factors.

.footnote[
Source: [forcats.tidyverse.org](http://forcats.tidyverse.org/)
]

---

## Recap

- Always best to think of data as part of a tibble
    + This plays nicely with the `tidyverse` as well
    + Rows are observations, columns are variables
    
- Be careful about data types / classes
    + Sometimes `R` makes silly assumptions about your data class 
        + Using `tibble`s help, but it might not solve all issues
        + Think about your data in context, e.g. 0/1 variable is most likely a `factor`
    + If a plot/output is not behaving the way you expect, first
    investigate the data class
    + If you are absolutely sure of a data class, overwrite it in your
    tibble so that you don't need to keep having to keep track of it
        + `mutate` the variable with the correct class
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightLines": true,
"highlightStyle": "github",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
